<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Aportes ONG</title>
    <link href="./style.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div id="app" class="container">
        <div id="login-module" class="login-container">
            <h2>Iniciar Sesión</h2>
            <div class="form-group">
                <label for="username">Usuario:</label>
                <input type="text" id="username" placeholder="Tu usuario">
            </div>
            <div class="form-group">
                <label for="password">Contraseña:</label>
                <input type="password" id="password" placeholder="Tu contraseña">
            </div>
            <button id="login-button">Ingresar</button>
            <p id="login-message" class="message error"></p>
        </div>

        <div id="main-app" class="hidden">
            <header>
                <h1>Sistema de Aportes ONG</h1>
                <nav>
                    <button id="dashboard-nav" class="nav-button admin-only">Dashboard</button>
                    <button id="aportes-nav" class="nav-button">Aportes / Participantes</button>
                    <button id="participantes-crud-nav" class="nav-button admin-only">Gestionar Participantes</button>
                    <button id="logout-button" class="nav-button logout">Cerrar Sesión</button>
                </nav>
            </header>

            <main>
                <section id="dashboard-module" class="hidden admin-only">
                    <h2>Dashboard</h2>
                    <div class="dashboard-grid">
                        <div class="card">
                            <h3>Aportes Totales por Mes y Año</h3>
                            <canvas id="total-aportes-chart"></canvas>
                            <p class="description">Gráfico de barras/líneas de aportes mensuales.</p>
                        </div>
                        <div class="card">
                            <h3>Media de Aportes</h3>
                            <p class="big-text" id="media-aportes">$0.00</p>
                            <p class="description">Promedio de los aportes recibidos.</p>
                        </div>
                        <div class="card">
                            <h3>Últimos 10 Aportes Recibidos</h3>
                            <ul id="ultimos-aportes-list">
                                </ul>
                            <p class="description">Visibilidad de las transacciones más recientes.</p>
                        </div>
                    </div>
                </section>

                <section id="aportes-participantes-module" class="hidden">
                    <h2>Aportes y Participantes</h2>

                    <div class="filter-section">
                        <div class="form-group">
                            <label for="filter-month">Filtrar por Mes:</label>
                            <input type="month" id="filter-month">
                        </div>
                        <div class="form-group admin-only">
                            <label for="filter-tutora">Filtrar por Tutora:</label>
                            <select id="filter-tutora">
                                <option value="">Todas</option>
                                </select>
                        </div>
                        <div class="form-group">
                            <label for="search-input">Buscar por Nombre o Código:</label>
                            <input type="text" id="search-input" placeholder="Nombre o Código">
                        </div>
                        <button id="apply-filters-button">Aplicar Filtros</button>
                    </div>

                    <div class="section-card">
                        <h3>Lista de Aportes Realizados</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Participante</th>
                                    <th class="admin-only">Tutora</th>
                                    <th>Monto Total</th>
                                    <th>Meses Pagados</th>
                                    <th>Abono</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="aportes-table-body">
                                </tbody>
                        </table>
                        <p id="no-aportes-message" class="message info hidden">No se encontraron aportes.</p>
                    </div>

                    <div class="section-card">
                        <h3>Registrar Nuevo Ingreso</h3>
                        <div class="form-group">
                            <label for="select-participante">Seleccionar Participante:</label>
                            <select id="select-participante">
                                <option value="">-- Seleccione un participante --</option>
                                </select>
                        </div>

                        <div id="participante-info" class="participant-details-grid hidden">
                            <div><strong>Código:</strong> <span id="info-codigo"></span></div>
                            <div><strong>Nombre:</strong> <span id="info-nombre"></span></div>
                            <div><strong>Ciudadanía:</strong> <span id="info-ciudadania"></span></div>
                            <div><strong>Último Mes Pagado:</strong> <span id="info-ultimo-mes-pagado"></span></div>
                            <div><strong>Meses Pendientes:</strong> <span id="info-meses-pendientes"></span></div>
                            <div><strong>Total Pendiente:</strong> <span id="info-total-pendiente"></span></div>
                            <div class="admin-only"><strong>Tutora:</strong> <span id="info-tutora"></span></div>
                        </div>

                        <div id="payment-section" class="hidden">
                            <h4>Meses a Pagar</h4>
                            <div id="meses-a-pagar-checkboxes" class="checkbox-grid">
                                </div>

                            <div class="form-group">
                                <label for="monto-abono">Monto de Abono (opcional):</label>
                                <input type="number" id="monto-abono" value="0">
                            </div>

                            <div class="form-group">
                                <label for="monto-total-a-cobrar">Monto Total a Cobrar al Padre:</label>
                                <input type="text" id="monto-total-a-cobrar" readonly>
                            </div>

                            <div class="form-group">
                                <label for="monto-recibido">Monto Recibido del Padre:</label>
                                <input type="number" id="monto-recibido" placeholder="Monto total recibido">
                            </div>

                            <button id="registrar-aporte-button">Registrar Aporte</button>
                            <p id="registro-message" class="message"></p>
                        </div>
                        <div id="tutora-payment-view" class="hidden">
                            <h3>Información de Pagos (Vista Tutora)</h3>
                            <div id="tutora-payment-table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Código</th>
                                            <th>Participante</th>
                                            <th>Ciudadanía</th>
                                            <th>Último Mes Pago</th>
                                            <th>Meses en Deuda</th>
                                            <th>Total a Pagar (al día)</th>
                                            <th>Ver Estado</th>
                                            <th>Compartir URL</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tutora-participantes-table-body">
                                        </tbody>
                                </table>
                            </div>
                            <div id="payment-status-modal" class="modal hidden">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h3>Estado de Pagos de <span id="modal-participant-name"></span></h3>
                                        <button class="close-button" onclick="document.getElementById('payment-status-modal').classList.add('hidden')">&times;</button>
                                    </div>
                                    <div id="payment-status-grid-container" class="scrollable-content">
                                        </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="participantes-crud-module" class="hidden admin-only">
                    <h2>Gestionar Participantes</h2>

                    <div class="section-card">
                        <h3>Lista de Participantes</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Código</th>
                                    <th>Nombre</th>
                                    <th>Ciudadanía</th>
                                    <th>Tutora</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="participantes-crud-table-body">
                                </tbody>
                        </table>
                    </div>

                    <div class="section-card">
                        <h3>Registrar / Modificar Participante</h3>
                        <input type="hidden" id="participante-id">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="new-codigo">Código:</label>
                                <input type="text" id="new-codigo">
                            </div>
                            <div class="form-group">
                                <label for="new-nombre">Nombre:</label>
                                <input type="text" id="new-nombre">
                            </div>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="new-ciudadania">Ciudadanía:</label>
                                <input type="text" id="new-ciudadania">
                            </div>
                            <div class="form-group">
                                <label for="new-tutora">Tutora:</label>
                                <select id="new-tutora">
                                    <option value="">-- Seleccione Tutora --</option>
                                    <option value="lisbeth">Lisbeth</option>
                                    <option value="diana">Diana</option>
                                    <option value="helen">Helen</option>
                                    <option value="juliana">Juliana</option>
                                </select>
                            </div>
                        </div>
                        <div class="button-group">
                            <button id="save-participante-button">Guardar Participante</button>
                            <button id="cancel-edit-button" class="hidden">Cancelar Edición</button>
                        </div>
                        <p id="crud-message" class="message"></p>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <script src="./app.js"></script>
</body>
</html>
